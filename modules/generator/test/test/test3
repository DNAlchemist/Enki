format_version: 5
environments:
  Building:
    pipelines:
    - IMAGE_imageName
pipelines:
  IMAGE_imageName:
    group: groupName
    label_template: ${code[:10]}
    materials:
      code:
        type: configrepo
        destination: code
    stages:
    - update-source-version:
          elastic_profile_id: "update-source-version"
          tasks:
            - script: |
                export CODE_PATH=$(pwd)/code
                sh /scripts/update-source-version
    - publish:
          elastic_profile_id: "packer.build-openstack-image"
          tasks:
            - script: |
                export CODE_PATH=$(pwd)/code
                sh /scripts/build-openstack-image
